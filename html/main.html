<!DOCTYPE html>
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		<title>MapApp - Plan Your Trip with MapApp</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="">
		<meta name="description" content="">
		<link href="../css/bootstrap.css" rel="stylesheet">
		<link href="../css/prototype.css" rel="stylesheet">
		
		<script src="../js/jquery-1.10.2.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../db/dummy.js"></script>
	</head>
	
	<body>
		<nav class="navbar navbar-inverse">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">MapApp</a>
				</div>
				<div class="navbar-collapse collapse navbar-right">
					<ul class="nav navbar-nav">
					</ul>
				</div><!--/.nav-collapse -->			
			</div>
		</nav>
		
		<div class="container">
			<section id="main-container">
				<h1>Plan your trip</h1>
				<section id="search">
					<form id="main-search-form">
						<div class="form-container">
							<label>What are you looking for</label>
							<input id="keywords" type="text" placeholder="" class="large-input" />
							<div id="search-details"></div>
							<button type="button" class="large-button" id="more-details">add more details</button>
							<button type="submit" class="large-button">Search</button>
						</div>
					</form>
				</section>
				<section id="results">
					
				</section>
			</section>
		</div>
		
		<footer>
			<div class="container">
				<nav class="footer">
					<ul>
						<small>
						<li><a href="#">About</a></li>
						<li><a href="#">Blog</a></li>
						<li><a href="#">Contact</a></li>
						</small>
					</ul>
				</nav>
				<div class="social">
					<a href="#"><img src="../img/facebook.png" alt="facebook"></a>
					<a href="#"><img src="../img/twitter.png" alt="twitter"></a>
					<a href="#"><img src="../img/linkedin.png" alt="linkedin"></a>
					<a href="#"><img src="../img/rss.png" alt="rss"></a>
				</div>
			</div>
		</footer>
		
		<script>
			
			var textSearch = true;
			var region = "";
			var numRules = 0;
			
			$(document).ready(function(event) {
				region = "Hunter Valley";
				$("#search-details").html = "";
				
				$("button#more-details").click(function() {
					$("#search-details").append("<div class='detail'><select class='criteria-select' id='criteria-select-" + numRules + "' onchange='switchCriteria(this)'><option value='day-open'>day open</option><option value='wine-variety'>wine variety</option><option value='wine-type'>wine type</option><option value='winery-size'>winery size</option><option value='made-at'>made at</option><option value='price-range'>price range</option><option value='tasting-price'>tasting price</option><option value='tour'>tour</option></select><select id='is-select'><option value='is'>is</option><option value='is-not'>is not</option></select><select id='attribute-select'><option value='mon'>monday</option><option value='tue'>tuesday</option><option value='wed'>wednesday</option><option value='thu'>thursday</option><option value='fri'>friday</option><option value='sat'>saturday</option><option value='sun'>sunday</option></select></div>");
					numRules++;
				});

				$("#main-search-form").on('submit', function(event) {
					event.preventDefault();
					search(region);
				});
			});
			
			function switchCriteria(criteria) {
				switch(criteria.options[criteria.selectedIndex].value) {
					case "day-open":
						console.log("day open");
						break;						
					
					case "wine-variety":
						console.log("wine variety");
						break;
					
					case "wine-type":
						console.log("wine type");
						break;
						
					case "winery-size":
						console.log("winery size");
						break;
					
					case "made-at":
						console.log("made at");
						break;
						
					case "price-range":
						console.log("price range");
						break;
						
					case "tasting-price":
						console.log("tasting price");
						break;
						
					case "tour":
						console.log("tour");
						break;
						
					default:
						break;
				}	
			}
			
			function search(region) {
				if(textSearch) {
					
				} else {
					var day = getDay();
					var prefferedPrice = getPrefferedPrice();
					var varieties = getVarieties(); //varieties array
					var type = getType(); //type array
					var size = getSize();
					var made = getMade();
					var tour = getTour();
					var tastingPrice = getTastingPrice();
					var searchCriteria = getSearchCriteria();
					
					if(searchCriteria == "all-check") {
						//Filter using all search criterias
						var results = allSearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice);
					} else {
						//Filter using any criteria
						var results = anySearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice);
					}
				}
			}
			
			function allSearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice) {
				var results = new Array();
			
				for(var i=0;i<wineries.length;i++) {
					if(wineries[i].location.region == region) {
						var found = true;
						
						if((day != "") && !(day in wineries[i].openDays)) {
							found = false;
						}
						
						if((prefferedPrice != "") && found) {
							if(!(prefferedPrice in wineries[i].price)) {
								found = false;
							}
						}
						
						if((varieties.length > 0) && found) {
							for(var i=0;i<varieties.length;i++) {
								if(!(varieties[i] in wineries[i].wineVariety)) {
									found = false;
									break;
								}
							}
						}
						
						if((type.length > 0) && found) {
							for(var i=0;type.length;i++) {
								if(!(type[i] in wineries[i].wineType)) {
									found = false;
									break;
								}
							}
						}
						
						if((size != "") && found) {
							if(!(size in wineries[i].wineSize)) {
								found = false;
							}
						}
						
						if((made != "") && found) {
							if(!(made in wineries[i].madeAt)) {
								found = false;
							}
						}
						
						if((tour != "any") && found) {
							if(wineries[i].tourAvailability != tour) {
								found = false;
							}
						}
						
						if((tastingPrice != "any") && found) {
							if(wineries[i].tastingPrice != tastingPrice) {
								found = false;
							}
						}
						
						if(found) {
							results.push(wineries[i]);
						}
					}
				}
				
				return results;
			}
			
			function anySearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice) {
				var results = new Array();
				
				for(var i=0;i<wineries.length;i++) {
					if(wineries[i].location.region == region) {
						var score = 0;
						
						if((day != "") && (day in wineries[i].openDays)) {
							score++;
						}
						
						if(prefferedPrice != "") {
							if(prefferedPrice in wineries[i].price) {
								score++;
							}
						}
						
						if(varieties.length > 0) {
							for(var i=0;i<varieties.length;i++) {
								if(varieties[i] in wineries[i].wineVariety) {
									score++;
								}
							}
						}
						
						if(type.length > 0) {
							for(var i=0;type.length;i++) {
								if(type[i] in wineries[i].wineType) {
									score++;
								}
							}
						}
						
						if(size != "") {
							if(size in wineries[i].wineSize) {
								score++;
							}
						}
						
						if(made != "") {
							if(made in wineries[i].madeAt) {
								score++;
							}
						}
						
						if(tour != "any") {
							if(wineries[i].tourAvailability == tour) {
								score++;
							}
						}
						
						if(tastingPrice != "any") {
							if(wineries[i].tastingPrice == tastingPrice) {
								score++;
							}
						}
						
						results.push({"winery": wineries[i], "score": score});
					}
				}
				
				return results;
			}
			
			function getDay() {
				return document.getElementById("day-select").value;
			}
			
			function getPrefferedPrice() {
				return document.getElementById("price-select").value;
			}
			
			function getVarieties() {
				var varieties = new Array();
				
				if(document.getElementById("blend-check").checked) { varieties.push("blend") };
				if(document.getElementById("cabernet-check").checked) { varieties.push("cabernet-sauvignon") };
				if(document.getElementById("chardonnay-check").checked) { varieties.push("chardonnay") };
				if(document.getElementById("merlot-check").checked) { varieties.push("merlot") };
				if(document.getElementById("moscato-check").checked) { varieties.push("moscato") };
				if(document.getElementById("pinot-check").checked) { varieties.push("pinot-noir") };
				if(document.getElementById("riesling-check").checked) { varieties.push("riesling") };
				if(document.getElementById("rose-check").checked) { varieties.push("rose") };
				if(document.getElementById("sauvignon-check").checked) { varieties.push("sauvignon-blanc") };
				if(document.getElementById("semillon-check").checked) { varieties.push("semillon") };
				if(document.getElementById("shiraz-check").checked) { varieties.push("shiraz") };
				if(document.getElementById("verdelho-check").checked) { varieties.push("verdelho") };
				if(document.getElementById("other-check").checked) { varieties.push("other") };
				
				return varieties;
			}
			
			function getType() {
				var type = new Array();
				
				if(document.getElementById("dessert-check").checked) { type.push("dessert") };
				if(document.getElementById("fortified-check").checked) { type.push("fortified") };
				if(document.getElementById("organic-check").checked) { type.push("organic") };
				if(document.getElementById("red-check").checked) { type.push("red") };
				if(document.getElementById("sparkling-check").checked) { type.push("sparkling") };
				if(document.getElementById("white-check").checked) { type.push("white") };
				
				return type;
			}
			
			function getSize() {
				return document.getElementById("size-select").value;
			}
			
			function getMade() {
				return $('input[name="made-radio"]:checked').val();
			}
			
			function getTour() {
				return $('input[name="tour-radio"]:checked').val();
			}
			
			function getTastingPrice() {
				return $('input[name="tasting-radio"]:checked').val();
			}
			
			function getSearchCriteria() {
				console.log($('input[name="criteria-radio"]:checked').val());
				return $('input[name="criteria-radio"]:checked').val();
			}
			
		</script>
	</body>
</html>