<!DOCTYPE html>
<html lang="en">
	
	<head>
		<meta charset="utf-8">
		<title>MapApp - Plan Your Trip with MapApp</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="author" content="">
		<meta name="description" content="">
		<link href="../css/bootstrap.css" rel="stylesheet">
		<link href="../css/prototype.css" rel="stylesheet">
		
		<script src="../js/jquery-1.10.2.min.js"></script>
		<script src="../js/bootstrap.min.js"></script>
		<script src="../db/dummy.js"></script>
	</head>
	
	<body>
		<nav class="navbar navbar-inverse">
			<div class="container">
				<div class="navbar-header">
					<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					</button>
					<a class="navbar-brand" href="#">MapApp</a>
				</div>
				<div class="navbar-collapse collapse navbar-right">
					<ul class="nav navbar-nav">
					</ul>
				</div><!--/.nav-collapse -->			
			</div>
		</nav>
		
		<div class="container">
			<section id="main-container">
				<h1>Plan your trip</h1>
				<section id="search">
					<form id="main-search-form">
						<div class="form-container">
							<label>What are you looking for</label>
							<input id="keywords" type="text" placeholder="" class="large-input" />
							<button type="button" class="large-button" id="more-details">more details</button>
							<div id="search-details">
								<label>Open day</label>
								<input type="text" class="large-input" id="day-select" />
								<label>Price per bottle</label>
								<input type="text" class="large-input" id="price-select" />
								<label>Wine variety</label>
								<ul class="variety-select">
									<li>Blend <input type="checkbox" class="type-checkbox" id="blend-check" value="blend" /> </li>
									<li>Cabernet Sauvignon <input type="checkbox" class="type-checkbox" id="cabernet-check" value="cabernet-sauvignon" /></li>
									<li>Chardonnay <input type="checkbox" class="type-checkbox" id="chardonnay-check" value="chardonnay" /></li>
									<li>Merlot <input type="checkbox" class="type-checkbox" id="merlot-check" value="merlot" /></li>
									<li>Moscato <input type="checkbox" class="type-checkbox" id="moscato-check" value="moscato" /></li>
									<li>Pinot Noir <input type="checkbox" class="type-checkbox" id="pinot-check" value="pinot-noir" /></li>
									<li>Riesling <input type="checkbox" class="type-checkbox" id="riesling-check" value="riesling" /></li>
									<li>Rose <input type="checkbox" class="type-checkbox" id="rose-check" value="rose" /></li>
									<li>Sauvignon Blanc <input type="checkbox" class="type-checkbox" id="sauvignon-check" value="sauvignon-blanc" /></li>
									<li>Semillon <input type="checkbox" class="type-checkbox" id="semillon-check" value="semillon" /></li>
									<li>Shiraz <input type="checkbox" class="type-checkbox" id="shiraz-check" value="shiraz" /></li>
									<li>Verdelho <input type="checkbox" class="type-checkbox" id="verdelho-check" value="verdelho" /></li>
									<li>Other <input type="checkbox" class="type-checkbox" id="other-check" value="other" /></li>
								</ul>
								<label>Wine type</label>
								<ul class="type-select">
									<li>Dessert <input type="checkbox" class="type-checkbox" id="dessert-check" value="dessert" /></li>
									<li>Fortified <input type="checkbox" class="type-checkbox" id="fortified-check" value="fortified" /></li>
									<li>Organic <input type="checkbox" class="type-checkbox" id="organic-check" value="organic" /></li>
									<li>Red <input type="checkbox" class="type-checkbox" id="red-check" value="red" /></li>
									<li>Sparkling <input type="checkbox" class="type-checkbox" id="sparkling-check" value="sparkling" /></li>
									<li>White <input type="checkbox" class="type-checkbox" id="white-check" value="white" /></li>
								</ul>
								<label>Winery size</label>
								<input type="text" class="large-input" id="size-select" />
								<label>Made at</label>
								<ul class="made-select">
									<li>Any <input type="radio" name="made-radio" class="type-radio" id="any-check" value="any" /></li>
									<li>Locally <input type="radio" name="made-radio" class="type-radio" id="local-check" value="local" /></li>
									<li>Different location <input type="radio" name="made-radio" class="type-radio" id="diff-check" value="diff" /></li>
								</ul>
								<label>Tour availability</label>
								<ul class="tour-select">
									<li>Any <input type="radio" name="tour-radio" class="type-radio" id="any-check" value="any" /></li>
									<li>Yes <input type="radio" name="tour-radio" class="type-radio" id="yes-check" value="yes" /></li>
									<li>No <input type="radio" name="tour-radio" class="type-radio" id="no-check" value="no" /></li>
								</ul>
								<label>Tasting price</label>
								<ul class="tasting-select">
									<li>Any <input type="radio" name="tasting-radio" class="type-radio" id="any-check" value="any" /></li>
									<li>Free <input type="radio" name="tasting-radio" class="type-radio" id="free-check" value="free" /></li>
									<li>Paid <input type="radio" name="tasting-radio" class="type-radio" id="paid-check" value="paid" /></li>
								</ul>
								<label>Search criteria</label>
								<ul class="criteria-select">
									<li>All <input type="radio" name="criteria-radio" class="type-radio" id="all-check" value="all" /></li>
									<li>Any <input type="radio" name="criteria-radio" class="type-radio" id="any-check" value="any" /></li>
								</ul>
							</div>
							<button type="submit" class="large-button">Search</button>
						</div>
					</form>
				</section>
				<section id="results">
					
				</section>
			</section>
		</div>
		
		<footer>
			<div class="container">
				<nav class="footer">
					<ul>
						<small>
						<li><a href="#">About</a></li>
						<li><a href="#">Blog</a></li>
						<li><a href="#">Contact</a></li>
						</small>
					</ul>
				</nav>
				<div class="social">
					<a href="#"><img src="../img/facebook.png" alt="facebook"></a>
					<a href="#"><img src="../img/twitter.png" alt="twitter"></a>
					<a href="#"><img src="../img/linkedin.png" alt="linkedin"></a>
					<a href="#"><img src="../img/rss.png" alt="rss"></a>
				</div>
			</div>
		</footer>
		
		<script>
			
			var textSearch = true;
			var region = "";
			
			$(document).ready(function(event) {
				$("#search-details").hide();
				region = "Hunter Valley";
				
				$("button#more-details").click(function() {
					$("#search-details").slideToggle("slow");
					if($("button#more-details").html() == "more details") {
						$("button#more-details").html("less details");
						textSearch = false;
					} else {
						$("button#more-details").html("more details");
						textSearch = true;
					}
				});
				
				$("#main-search-form").on('submit', function(event) {
					event.preventDefault();
					search(region);
				});
			});
			
			function search(region) {
				if(textSearch) {
					
				} else {
					var day = getDay();
					var prefferedPrice = getPrefferedPrice();
					var varieties = getVarieties(); //varieties array
					var type = getType(); //type array
					var size = getSize();
					var made = getMade();
					var tour = getTour();
					var tastingPrice = getTastingPrice();
					var searchCriteria = getSearchCriteria();
					
					if(searchCriteria == "all-check") {
						//Filter using all search criterias
						var results = allSearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice);
					} else {
						//Filter using any criteria
						var results = anySearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice);
					}
				}
			}
			
			function allSearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice) {
				var results = new Array();
			
				for(var i=0;i<wineries.length;i++) {
					if(wineries[i].location.region == region) {
						var found = true;
						
						if((day != "") && !(day in wineries[i].openDays)) {
							found = false;
						}
						
						if((prefferedPrice != "") && found) {
							if(!(prefferedPrice in wineries[i].price)) {
								found = false;
							}
						}
						
						if((varieties.length > 0) && found) {
							for(var i=0;i<varieties.length;i++) {
								if(!(varieties[i] in wineries[i].wineVariety)) {
									found = false;
									break;
								}
							}
						}
						
						if((type.length > 0) && found) {
							for(var i=0;type.length;i++) {
								if(!(type[i] in wineries[i].wineType)) {
									found = false;
									break;
								}
							}
						}
						
						if((size != "") && found) {
							if(!(size in wineries[i].wineSize)) {
								found = false;
							}
						}
						
						if((made != "") && found) {
							if(!(made in wineries[i].madeAt)) {
								found = false;
							}
						}
						
						if((tour != "any") && found) {
							if(wineries[i].tourAvailability != tour) {
								found = false;
							}
						}
						
						if((tastingPrice != "any") && found) {
							if(wineries[i].tastingPrice != tastingPrice) {
								found = false;
							}
						}
						
						if(found) {
							results.push(wineries[i]);
						}
					}
				}
				
				return results;
			}
			
			function anySearch(region, day, prefferedPrice, varieties, type, size, made, tour, tastingPrice) {
				var results = new Array();
				
				for(var i=0;i<wineries.length;i++) {
					if(wineries[i].location.region == region) {
						var score = 0;
						
						if((day != "") && (day in wineries[i].openDays)) {
							score++;
						}
						
						if(prefferedPrice != "") {
							if(prefferedPrice in wineries[i].price) {
								score++;
							}
						}
						
						if(varieties.length > 0) {
							for(var i=0;i<varieties.length;i++) {
								if(varieties[i] in wineries[i].wineVariety) {
									score++;
								}
							}
						}
						
						if(type.length > 0) {
							for(var i=0;type.length;i++) {
								if(type[i] in wineries[i].wineType) {
									score++;
								}
							}
						}
						
						if(size != "") {
							if(size in wineries[i].wineSize) {
								score++;
							}
						}
						
						if(made != "") {
							if(made in wineries[i].madeAt) {
								score++;
							}
						}
						
						if(tour != "any") {
							if(wineries[i].tourAvailability == tour) {
								score++;
							}
						}
						
						if(tastingPrice != "any") {
							if(wineries[i].tastingPrice == tastingPrice) {
								score++;
							}
						}
						
						results.push({"winery": wineries[i], "score": score});
					}
				}
				
				return results;
			}
			
			function getDay() {
				return document.getElementById("day-select").value;
			}
			
			function getPrefferedPrice() {
				return document.getElementById("price-select").value;
			}
			
			function getVarieties() {
				var varieties = new Array();
				
				if(document.getElementById("blend-check").checked) { varieties.push("blend") };
				if(document.getElementById("cabernet-check").checked) { varieties.push("cabernet-sauvignon") };
				if(document.getElementById("chardonnay-check").checked) { varieties.push("chardonnay") };
				if(document.getElementById("merlot-check").checked) { varieties.push("merlot") };
				if(document.getElementById("moscato-check").checked) { varieties.push("moscato") };
				if(document.getElementById("pinot-check").checked) { varieties.push("pinot-noir") };
				if(document.getElementById("riesling-check").checked) { varieties.push("riesling") };
				if(document.getElementById("rose-check").checked) { varieties.push("rose") };
				if(document.getElementById("sauvignon-check").checked) { varieties.push("sauvignon-blanc") };
				if(document.getElementById("semillon-check").checked) { varieties.push("semillon") };
				if(document.getElementById("shiraz-check").checked) { varieties.push("shiraz") };
				if(document.getElementById("verdelho-check").checked) { varieties.push("verdelho") };
				if(document.getElementById("other-check").checked) { varieties.push("other") };
				
				return varieties;
			}
			
			function getType() {
				var type = new Array();
				
				if(document.getElementById("dessert-check").checked) { type.push("dessert") };
				if(document.getElementById("fortified-check").checked) { type.push("fortified") };
				if(document.getElementById("organic-check").checked) { type.push("organic") };
				if(document.getElementById("red-check").checked) { type.push("red") };
				if(document.getElementById("sparkling-check").checked) { type.push("sparkling") };
				if(document.getElementById("white-check").checked) { type.push("white") };
				
				return type;
			}
			
			function getSize() {
				return document.getElementById("size-select").value;
			}
			
			function getMade() {
				return $('input[name="made-radio"]:checked').val();
			}
			
			function getTour() {
				return $('input[name="tour-radio"]:checked').val();
			}
			
			function getTastingPrice() {
				return $('input[name="tasting-radio"]:checked').val();
			}
			
			function getSearchCriteria() {
				console.log($('input[name="criteria-radio"]:checked').val());
				return $('input[name="criteria-radio"]:checked').val();
			}
			
		</script>
	</body>
</html>